(function(h,g){typeof exports=="object"&&typeof module<"u"?g(exports,require("@instantdb/core"),require("solid-js")):typeof define=="function"&&define.amd?define(["exports","@instantdb/core","solid-js"],g):(h=typeof globalThis<"u"?globalThis:h||self,g(h.InstantDBSolid={},h.InstantDBCore,h.SolidJS))})(this,function(h,g,a){"use strict";var Ie=Object.defineProperty;var Ne=(h,g,a)=>g in h?Ie(h,g,{enumerable:!0,configurable:!0,writable:!0,value:a}):h[g]=a;var b=(h,g,a)=>Ne(h,typeof g!="symbol"?g+"":g,a);function G(){let n=null;const e=(i,s)=>{clearTimeout(n),n=setTimeout(s,i)},t=()=>{clearTimeout(n)};return a.onCleanup(()=>t()),{set:e,clear:t}}const F=1e3;function z(n,e,t){a.createEffect(()=>{const i=n._core._reactor.subscribeTopic(n.id,e,(s,c)=>{t(s,c)});a.onCleanup(i)})}function H(n,e){return a.createEffect(()=>n._core._reactor.joinRoom(n.id)),t=>{n._core._reactor.publishTopic({roomType:n.type,roomId:n.id,topic:e,data:t})}}function k(n,e={}){const[t,i]=a.createSignal(n._core._reactor.getPresence(n.type,n.id,e)??{peers:{},isLoading:!0});a.createEffect(()=>{const c=n._core._reactor.subscribePresence(n.type,n.id,e,o=>{i(o)});a.onCleanup(c)});const s=c=>{n._core._reactor.publishPresence(n.type,n.id,c)};return{...t(),publishPresence:s}}function K(n,e,t=[]){a.createEffect(()=>n._core._reactor.joinRoom(n.id)),a.createEffect(()=>{n._core._reactor.publishPresence(n.type,n.id,e)},t)}function U(n,e,t={}){const i=G();k(n,{keys:[e]});const s=()=>{const l=n._core._reactor.getPresence(n.type,n.id);return t!=null&&t.writeOnly?[]:Object.values((l==null?void 0:l.peers)??{}).filter(u=>u[e]===!0)},c=l=>{n._core._reactor.publishPresence(n.type,n.id,{[e]:l}),l&&((t==null?void 0:t.timeout)===null||(t==null?void 0:t.timeout)===0||i.set((t==null?void 0:t.timeout)??F,()=>{n._core._reactor.publishPresence(n.type,n.id,{[e]:null})}))},f={onKeyDown:l=>{const E=!((t==null?void 0:t.stopOnEnter)&&l.key==="Enter");c(E)},onBlur:()=>{c(!1)}};return{active:s(),setActive:c,inputProps:f}}const S={createTopicEffect:z,createPublishTopic:H,createPresence:k,createSyncPresence:K,createTypingIndicator:U};class V{constructor(e,t,i){b(this,"_core");b(this,"type");b(this,"id");this._core=e,this.type=t,this.id=i}createTopicEffect(e,t){S.createTopicEffect(this,e,t)}createPublishTopic(e){return S.createPublishTopic(this,e)}createPresence(e={}){return S.createPresence(this,e)}createSyncPresence(e,t=[]){return S.createSyncPresence(this,e,t)}createTypingIndicator(e,t={}){return S.createTypingIndicator(this,e,t)}}function Q(n){return{isLoading:!n,data:void 0,pageInfo:void 0,error:void 0,...n||{}}}function X(n,e,t){e&&t&&"ruleParams"in t&&(e={$$ruleParams:t.ruleParams,...e});const i=e?g.coerceQuery(e):null;g.weakHash(i);const[s,c]=a.createSignal(Q(n._reactor.getPreviousResult(i)));return a.createEffect(()=>{if(!i)return;const o=n.subscribeQuery(i,r=>{c({isLoading:!r,data:void 0,pageInfo:void 0,error:void 0,...r})});a.onCleanup(()=>o())}),{state:s(),query:i}}class _{constructor(e,t){b(this,"tx",g.txInit());b(this,"auth");b(this,"storage");b(this,"_core");b(this,"getLocalId",e=>this._core.getLocalId(e));b(this,"useLocalId",e=>{const[t,i]=a.createSignal(null);return a.createEffect(()=>{let s=!0;(async()=>{const o=await this.getLocalId(e);s&&i(o)})(),a.onCleanup(()=>s=!1)}),t()});b(this,"rooms",{});b(this,"transact",e=>this._core.transact(e));b(this,"useQuery",(e,t)=>X(this._core,e,t).state);b(this,"useAuth",()=>{const e=this._core._reactor._currentUserCached,[t,i]=a.createSignal(e);return a.createEffect(()=>{const s=this._core.subscribeAuth(c=>{i({isLoading:!1,...c})});a.onCleanup(()=>s())}),t()});b(this,"useConnectionStatus",()=>{const e=this._core._reactor.status,[t,i]=a.createSignal(e);return a.createEffect(()=>{const s=this._core.subscribeConnectionStatus(c=>{c!==e&&i(c)});a.onCleanup(()=>s())}),t()});b(this,"queryOnce",(e,t)=>this._core.queryOnce(e,t));this._core=g.init(e,this.constructor.Storage,this.constructor.NetworkListener,t),this.auth=this._core.auth,this.storage=this._core.storage}room(e="_defaultRoomType",t="_defaultRoomId"){return new V(this._core,e,t)}getAuth(){return this._core.getAuth()}}b(_,"Storage"),b(_,"NetworkListener");class I extends _{}const q="v1.0.0";function W(n){return new I(n,{"@jeetkhinde/instantdb-solid":q})}const Y=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","disabled","formnovalidate","hidden","indeterminate","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","seamless","selected"],Z=new Set(["className","value","readOnly","formNoValidate","isMap","noModule","playsInline",...Y]),v=new Set(["innerHTML","textContent","innerText","children"]),J=Object.assign(Object.create(null),{className:"class",htmlFor:"for"}),ee=Object.assign(Object.create(null),{class:"className",formnovalidate:{$:"formNoValidate",BUTTON:1,INPUT:1},ismap:{$:"isMap",IMG:1},nomodule:{$:"noModule",SCRIPT:1},playsinline:{$:"playsInline",VIDEO:1},readonly:{$:"readOnly",INPUT:1,TEXTAREA:1}});function te(n,e){const t=ee[n];return typeof t=="object"?t[e]?t.$:void 0:t}const ne=new Set(["beforeinput","click","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"]),ie=new Set(["altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignObject","g","glyph","glyphRef","hkern","image","line","linearGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","set","stop","svg","switch","symbol","text","textPath","tref","tspan","use","view","vkern"]),ce={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"};function re(n,e,t){let i=t.length,s=e.length,c=i,o=0,r=0,f=e[s-1].nextSibling,l=null;for(;o<s||r<c;){if(e[o]===t[r]){o++,r++;continue}for(;e[s-1]===t[c-1];)s--,c--;if(s===o){const u=c<i?r?t[r-1].nextSibling:t[c-r]:f;for(;r<c;)n.insertBefore(t[r++],u)}else if(c===r)for(;o<s;)(!l||!l.has(e[o]))&&e[o].remove(),o++;else if(e[o]===t[c-1]&&t[r]===e[s-1]){const u=e[--s].nextSibling;n.insertBefore(t[r++],e[o++].nextSibling),n.insertBefore(t[--c],u),e[s]=t[c]}else{if(!l){l=new Map;let E=r;for(;E<c;)l.set(t[E],E++)}const u=l.get(e[o]);if(u!=null)if(r<u&&u<c){let E=o,y=1,C;for(;++E<s&&E<c&&!((C=l.get(e[E]))==null||C!==u+y);)y++;if(y>u-r){const T=e[o];for(;r<u;)n.insertBefore(t[r++],T)}else n.replaceChild(t[r++],e[o++])}else o++;else e[o++].remove()}}}const N="_$DX_DELEGATE";function se(n,e=window.document){const t=e[N]||(e[N]=new Set);for(let i=0,s=n.length;i<s;i++){const c=n[i];t.has(c)||(t.add(c),e.addEventListener(c,Ee))}}function $(n,e,t){P(n)||(t==null?n.removeAttribute(e):n.setAttribute(e,t))}function oe(n,e,t,i){P(n)||(i==null?n.removeAttributeNS(e,t):n.setAttributeNS(e,t,i))}function ae(n,e,t){P(n)||(t?n.setAttribute(e,""):n.removeAttribute(e))}function fe(n,e){P(n)||(e==null?n.removeAttribute("class"):n.className=e)}function le(n,e,t,i){if(i)Array.isArray(t)?(n[`$$${e}`]=t[0],n[`$$${e}Data`]=t[1]):n[`$$${e}`]=t;else if(Array.isArray(t)){const s=t[0];n.addEventListener(e,t[0]=c=>s.call(n,t[1],c))}else n.addEventListener(e,t,typeof t!="function"&&t)}function ue(n,e,t={}){const i=Object.keys(e||{}),s=Object.keys(t);let c,o;for(c=0,o=s.length;c<o;c++){const r=s[c];!r||r==="undefined"||e[r]||(O(n,r,!1),delete t[r])}for(c=0,o=i.length;c<o;c++){const r=i[c],f=!!e[r];!r||r==="undefined"||t[r]===f||!f||(O(n,r,!0),t[r]=f)}return t}function he(n,e,t){if(!e)return t?$(n,"style"):e;const i=n.style;if(typeof e=="string")return i.cssText=e;typeof t=="string"&&(i.cssText=t=void 0),t||(t={}),e||(e={});let s,c;for(c in t)e[c]==null&&i.removeProperty(c),delete t[c];for(c in e)s=e[c],s!==t[c]&&(i.setProperty(c,s),t[c]=s);return t}function de(n,e={},t,i){const s={};return a.createRenderEffect(()=>s.children=x(n,e.children,s.children)),a.createRenderEffect(()=>typeof e.ref=="function"&&ge(e.ref,n)),a.createRenderEffect(()=>ye(n,e,t,!0,s,!0)),s}function ge(n,e,t){return a.untrack(()=>n(e,t))}function ye(n,e,t,i,s={},c=!1){e||(e={});for(const o in s)if(!(o in e)){if(o==="children")continue;s[o]=j(n,o,null,s[o],t,c,e)}for(const o in e){if(o==="children")continue;const r=e[o];s[o]=j(n,o,r,s[o],t,c,e)}}function me(n){let e,t;return!P()||!(e=a.sharedConfig.registry.get(t=Ce()))?n():(a.sharedConfig.completed&&a.sharedConfig.completed.add(e),a.sharedConfig.registry.delete(t),e)}function P(n){return!!a.sharedConfig.context&&!a.sharedConfig.done&&(!n||n.isConnected)}function be(n){return n.toLowerCase().replace(/-([a-z])/g,(e,t)=>t.toUpperCase())}function O(n,e,t){const i=e.trim().split(/\s+/);for(let s=0,c=i.length;s<c;s++)n.classList.toggle(i[s],t)}function j(n,e,t,i,s,c,o){let r,f,l,u,E;if(e==="style")return he(n,t,i);if(e==="classList")return ue(n,t,i);if(t===i)return i;if(e==="ref")c||t(n);else if(e.slice(0,3)==="on:"){const y=e.slice(3);i&&n.removeEventListener(y,i,typeof i!="function"&&i),t&&n.addEventListener(y,t,typeof t!="function"&&t)}else if(e.slice(0,10)==="oncapture:"){const y=e.slice(10);i&&n.removeEventListener(y,i,!0),t&&n.addEventListener(y,t,!0)}else if(e.slice(0,2)==="on"){const y=e.slice(2).toLowerCase(),C=ne.has(y);if(!C&&i){const T=Array.isArray(i)?i[0]:i;n.removeEventListener(y,T)}(C||t)&&(le(n,y,t,C),C&&se([y]))}else if(e.slice(0,5)==="attr:")$(n,e.slice(5),t);else if(e.slice(0,5)==="bool:")ae(n,e.slice(5),t);else if((E=e.slice(0,5)==="prop:")||(l=v.has(e))||!s&&((u=te(e,n.tagName))||(f=Z.has(e)))||(r=n.nodeName.includes("-")||"is"in o)){if(E)e=e.slice(5),f=!0;else if(P(n))return t;e==="class"||e==="className"?fe(n,t):r&&!f&&!l?n[be(e)]=t:n[u||e]=t}else{const y=s&&e.indexOf(":")>-1&&ce[e.split(":")[0]];y?oe(n,y,e,t):$(n,J[e]||e,t)}return t}function Ee(n){if(a.sharedConfig.registry&&a.sharedConfig.events&&a.sharedConfig.events.find(([f,l])=>l===n))return;let e=n.target;const t=`$$${n.type}`,i=n.target,s=n.currentTarget,c=f=>Object.defineProperty(n,"target",{configurable:!0,value:f}),o=()=>{const f=e[t];if(f&&!e.disabled){const l=e[`${t}Data`];if(l!==void 0?f.call(e,l,n):f.call(e,n),n.cancelBubble)return}return e.host&&typeof e.host!="string"&&!e.host._$host&&e.contains(n.target)&&c(e.host),!0},r=()=>{for(;o()&&(e=e._$host||e.parentNode||e.host););};if(Object.defineProperty(n,"currentTarget",{configurable:!0,get(){return e||document}}),a.sharedConfig.registry&&!a.sharedConfig.done&&(a.sharedConfig.done=_$HY.done=!0),n.composedPath){const f=n.composedPath();c(f[0]);for(let l=0;l<f.length-2&&(e=f[l],!!o());l++){if(e._$host){e=e._$host,r();break}if(e.parentNode===s)break}}else r();c(i)}function x(n,e,t,i,s){const c=P(n);if(c){!t&&(t=[...n.childNodes]);let r=[];for(let f=0;f<t.length;f++){const l=t[f];l.nodeType===8&&l.data.slice(0,2)==="!$"?l.remove():r.push(l)}t=r}for(;typeof t=="function";)t=t();if(e===t)return t;const o=typeof e;if(n=n,o==="string"||o==="number"){if(c||o==="number"&&(e=e.toString(),e===t))return t;t!==""&&typeof t=="string"?t=n.firstChild.data=e:t=n.textContent=e}else if(e==null||o==="boolean"){if(c)return t;t=A(n,t,i)}else{if(o==="function")return a.createRenderEffect(()=>{let r=e();for(;typeof r=="function";)r=r();t=x(n,r,t,i)}),()=>t;if(Array.isArray(e)){const r=[],f=t&&Array.isArray(t);if(L(r,e,t,s))return a.createRenderEffect(()=>t=x(n,r,t,i,!0)),()=>t;if(c)return r.length?t=[...n.childNodes]:t;r.length===0?t=A(n,t,i):f?t.length===0?M(n,r,i):re(n,t,r):(t&&A(n),M(n,r)),t=r}else if(e.nodeType){if(c&&e.parentNode)return t=e;Array.isArray(t)?A(n,t,null,e):t==null||t===""||!n.firstChild?n.appendChild(e):n.replaceChild(e,n.firstChild),t=e}}return t}function L(n,e,t,i){let s=!1;for(let c=0,o=e.length;c<o;c++){let r=e[c],f=t&&t[n.length],l;if(!(r==null||r===!0||r===!1))if((l=typeof r)=="object"&&r.nodeType)n.push(r);else if(Array.isArray(r))s=L(n,r,f)||s;else if(l==="function")if(i){for(;typeof r=="function";)r=r();s=L(n,Array.isArray(r)?r:[r],Array.isArray(f)?f:[f])||s}else n.push(r),s=!0;else{const u=String(r);f&&f.nodeType===3&&f.data===u?n.push(f):n.push(document.createTextNode(u))}}return s}function M(n,e,t=null){for(let i=0,s=e.length;i<s;i++)n.insertBefore(e[i],t)}function A(n,e,t,i){if(t===void 0)return n.textContent="";const s=i||document.createTextNode("");if(e.length){let c=!1;for(let o=e.length-1;o>=0;o--){const r=e[o];if(s!==r){const f=r.parentNode===n;!c&&!o?f?n.replaceChild(s,r):n.insertBefore(s,t):f&&r.remove()}else c=!0}}else n.insertBefore(s,t);return[s]}function Ce(){return a.sharedConfig.getNextContextId()}const we="http://www.w3.org/2000/svg";function Pe(n,e=!1){return e?document.createElementNS(we,n):document.createElement(n)}function Se(n,e){const t=a.createMemo(n);return a.createMemo(()=>{const i=t();switch(typeof i){case"function":return a.untrack(()=>i(e));case"string":const s=ie.has(i),c=a.sharedConfig.context?me():Pe(i,s);return de(c,e,s),c}})}function Te(n){const[,e]=a.splitProps(n,["component"]);return Se(()=>n.component,e)}function _e({as:n="div",spaceId:e,room:t,className:i,style:s,userCursorColor:c,children:o,renderCursor:r,propagate:f,zIndex:l}){const u=e||`cursors-space-default--${String(t.type)}-${t.id}`,E=t.createPresence({keys:[u]}),y=t._core._reactor.getPresence(t.type,t.id);function C(d,w){const m=w.clientX,p=w.clientY,R=(m-d.left)/d.width*100,ke=(p-d.top)/d.height*100;E.publishPresence({[u]:{x:m,y:p,xPercent:R,yPercent:ke,color:c}})}const T=d=>{if(f||d.stopPropagation(),d.currentTarget instanceof Element){const w=d.currentTarget.getBoundingClientRect();C(w,d)}};function D(){E.publishPresence({[u]:void 0})}const xe=d=>{D()},Le=d=>{if(d.touches.length!==1)return;const w=d.touches[0];if(w.target instanceof Element){f||d.stopPropagation();const m=w.target.getBoundingClientRect();C(m,w)}},Re=d=>{D()};return a.createMemo(()=>{var d;return Object.entries(((d=E.state())==null?void 0:d.peers)??{})}),React.createElement(Te,{component:n,onMouseMove:T,onMouseOut:xe,onTouchMove:Le,onTouchEnd:Re,className:i,style:{position:"relative",...s||{}}},o,React.createElement("div",{key:u,style:{...B,...pe,"z-index":l!==void 0?l:$e}},Object.entries(E.peers).map(([d,w])=>{const m=w[u];return m?React.createElement("div",{key:d,style:{...B,transform:`translate(${(m==null?void 0:m.xPercent)??0}%, ${(m==null?void 0:m.yPercent)??0}%)`,"transform-origin":"0 0",transition:"transform 100ms"}},React.createElement(a.Show,{when:r,fallback:React.createElement(Ae,{color:m==null?void 0:m.color}),children:p=>{const R=y.peers[d];return p({color:(m==null?void 0:m.color)??"",presence:R??{}})}})):null})))}function Ae(n){const t=()=>n.color||"black";return React.createElement("svg",{style:{height:"35px",width:"35px"},viewBox:"0 0 35 35",fill:"none",xmlns:"http://www.w3.org/2000/svg"},React.createElement("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-12 -8.4)"},React.createElement("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),React.createElement("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})),React.createElement("g",{fill:"white",transform:"translate(-12 -8.4)"},React.createElement("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),React.createElement("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})),React.createElement("g",{fill:t(),transform:"translate(-12 -8.4)"},React.createElement("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),React.createElement("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})))}const B={position:"absolute",top:"0",left:"0",bottom:"0",right:"0"},pe={overflow:"hidden","pointer-events":"none","user-select":"none"},$e=99999;Object.defineProperty(h,"i",{enumerable:!0,get:()=>g.i}),Object.defineProperty(h,"id",{enumerable:!0,get:()=>g.id}),Object.defineProperty(h,"lookup",{enumerable:!0,get:()=>g.lookup}),Object.defineProperty(h,"tx",{enumerable:!0,get:()=>g.tx}),h.Cursors=_e,h.InstantSolidAbstractDatabase=_,h.InstantSolidWebDatabase=I,h.init=W,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});
